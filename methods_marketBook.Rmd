---
title: "marketBook"
---

**This method still might require some work, especially in parsing the response from Betfair.**

Having logged in using the [`betfair`](betfair.html) function, the environment contains the `marketBook` method, which can be used to get market data.  You can use `marketBook` to retrieve data about the market, but more importantly the price data for the various runners in the market.

### usage

```{r eval=FALSE}
bf$marketBook(marketIds = list(),
              priceProjection = "EX_BEST_OFFERS",
              orderProjection = "EXECUTABLE",
              matchProjection = "NO_ROLLUP",
              getRunners = NULL)
```

### arguments

param | details
------|-------------------------------------------------------------------------
`marketIds` | _string_, one or more marketIds, the number of markets returned depends on the amount of data you request via the `priceProjection`
`priceProjection` | the projection of price data you want to receive in the response, options include **SP\_AVAILABLE**, **SP\_TRADED**, **EX\_BEST\_OFFERS**, **EX\_ALL\_OFFERS** (trumps EX\_BEST\_OFFERS), and **EX\_TRADED**, these are expained in [Betting Enums](betting_enums.html#pricedata) under the Price Data header.
`orderProjection` | the order Projection you wish to receive in the response, **ALL** all orders (entirely matched, or not), **EXECUTABLE** orders with unmatched portion, **EXECUTION\_COMPLETE** orders with no unmatched portion, see [Betting Enums](betting_enums.html#orderprojection) under the Order Projection header.
`matchProjection` | if you ask for orders via `orderProjection`, this will specify the representation of the matched bets, options are **NO\_ROLLUP** returns raw fragments, **ROLLED\_UP\_BY\_PRICE** rolled up matched amounts by distinct matched prices per side, and **ROLLED\_UP\_BY\_AVG\_PRICE** rolled up by average price per side, see [Betting Enums](betting_enums.html#matchprojection) under Match Projection header.
`getRUnners` | if you wish to retrieve data about the runners, such as runners names (which are found in the [`marketCatalogue`])[methods_marketCatalogue.html] method) then you can supply either **RUNNER_DESCRIPTION** or **RUNNER_METADATA** to this parameter which will append runner data to the response

### return

A list with 3 elements, there are two dataframes, one about the market, and one about the runners.  The list also contains the raw response which may contain additional data that may be of interest.  Some of this additional data could be market depth data if **EX\_ALL\_OFFERS** is entered into the `priceProjection` parameter.  The list returned can be printed, allowing for quick glance at the market before users analyse the data further, or the list can be summarised.

### examples

```{r  comment=""}
library(betfaiR)
# login
bf <- betfair(usr = Sys.getenv("BETFAIR_USR"),
              pwd = Sys.getenv("BETFAIR_PWD"),
              key = Sys.getenv("BETFAIR_KEY"))

# get market data on just one market
tmp <- bf$marketCatalogue(filter = marketFilter(eventTypeIds = 1,
                                                marketTypeCodes = "MATCH_ODDS"),
                          marketProjection = "COMPETITION",
                          maxResults = 5)
summary(tmp)

# find market with most matched
ind <- which.max(sapply(tmp, function(i) i$market$totalMatched))
market <- tmp[[ind]]
summary(market)

market <- bf$marketBook(marketIds = market$market$marketId)
summary(market)

# collect data on all 5 markets
markets <- bf$marketBook(marketIds = sapply(tmp, function(i) i$market$marketId))
summary(markets)

# return runner data
marketId <- bf$marketCatalogue(filter = marketFilter(eventTypeIds = 7,
                                                     marketCountries = "GB",
                                                     marketTypeCodes = "WIN"))
summary(marketId)
market_with_runner_data <- bf$marketBook(marketIds = marketId[[1]]$market$marketId,
                                         getRunners = "RUNNER_METADATA")
market_with_runner_data[[1]]$runners
str(market_with_runner_data[[1]]$runner_metadata)
```

<a href="https://github.com/durtal/betfaiR" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#d9230f; color:#fcfcfc; position: absolute; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
