<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>marketBook</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">

	/* padding for bootstrap navbar */
	body {
		padding-top: 20px;
		padding-bottom: 20px;
	}
	@media (max-width: 979px) {
		body {
			padding-top: 0;
		}
	}

	/* offset scroll position for anchor links (for fixed navbar) */
	@media (min-width: 980px) {
		.section h2 {
			padding-top: 52px;
			margin-top: -52px;
		}
		.section h3 {
			padding-top: 52px;
			margin-top: -52px;
		}
	}

	p {
		font-size: 13px;
	}

	/* don't use link color in navbar */
	.dropdown-menu>li>a {
		color: black;
	}

	/* some padding for disqus */
	#disqus_thread {
		margin-top: 45px;
	}

</style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<h1>betfaiR</h1>
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#betfaiR-nav">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://github.com/durtal" class="navbar-brand">durtal@github</a>
        </div>
        <div class="collapse navbar-collapse" id="betfaiR-nav">
            <ul class="nav navbar-nav">
                <li>
                    <a href="index.html">home</a>
                </li>
                <li class="dropdown">
                    <a href="Primary" class="dropdown-toggle" data-toggle="dropdown">
                        Functions <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">Environment</li>
                        <li>
                            <a href="betfair.html">betfair</a>
                        </li>
                        <li class="dropdown-header">Helpers</li>
                        <li>
                            <a href="marketFilter.html">marketFilter</a>
                        </li>
                        <li>
                            <a href="bf_helpers.html">bf_helpers</a>
                        </li>
                        <li>
                            <a href="betfair_login.html">bf_login</a>
                        </li>
                        <li>
                            <a href="request_functions.html">requests</a>
                        </li>
                        <li>
                            <a href="betfair_POST.html">bf_post</a>
                        </li>
                        <li>
                            <a href="betfair_check.html">bf_check</a>
                        </li>
                        <li>
                            <a href="betfair_parse.html">bf_parse</a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="Methods" class="dropdown-toggle" data-toggle="dropdown">
                        Methods <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">summary data</li>
                        <li>
                            <a href="methods_competitions.html">competitions</a>
                        </li>
                        <li>
                            <a href="methods_countries.html">countries</a>
                        </li>
                        <li>
                            <a href="methods_events.html">events</a>
                        </li>
                        <li>
                            <a href="methods_eventTypes.html">eventTypes</a>
                        </li>
                        <li>
                            <a href="methods_venues.html">venues</a>
                        </li>
                        <li class="dropdown-header">login</li>
                        <li>
                            <a href="login_session.html">login + session</a>
                        </li>
                        <li class="dropdown-header">market data</li>
                        <li>
                            <a href="methods_marketTypes.html">marketTypes</a>
                        </li>
                        <li>
                            <a href="methods_marketCatalogue.html">marketCatalogue</a>
                        </li>
                        <li>
                            <a href="methods_marketBook.html">marketBook</a>
                        </li>
                        <li>
                            <a href="methods_marketPnL.html">marketPnL</a>
                        </li>
                        <li class="dropdown-header">orders</li>
                        <li>
                            <a href="placeOrders.html">placeOrders</a>
                        </li>
                        <li>
                            <a href="cancelOrders.html">cancelOrders</a>
                        </li>
                        <li>
                            <a href="replaceOrders.html">replaceOrders</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="Misc" class="dropdown-toggle" data-toggle="dropdown">
                        Misc <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="betting_enums.html">Betting Enums</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="http://www.github.com/durtal/betfaiR"> <i class="fa fa-github-square fa-lg"></i></a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div id="header">
<h1 class="title">marketBook</h1>
</div>


<p><strong>This method still might require some work, especially in parsing the response from Betfair.</strong></p>
<p>Having logged in using the <a href="betfair.html"><code>betfair</code></a> function, the environment contains the <code>marketBook</code> method, which can be used to get market data. You can use <code>marketBook</code> to retrieve data about the market, but more importantly the price data for the various runners in the market.</p>
<div id="usage" class="section level3">
<h3>usage</h3>
<pre class="sourceCode r"><code class="sourceCode r">bf$<span class="kw">marketBook</span>(<span class="dt">marketIds =</span> <span class="kw">list</span>(),
              <span class="dt">priceProjection =</span> <span class="st">&quot;EX_BEST_OFFERS&quot;</span>,
              <span class="dt">orderProjection =</span> <span class="st">&quot;EXECUTABLE&quot;</span>,
              <span class="dt">matchProjection =</span> <span class="st">&quot;NO_ROLLUP&quot;</span>)</code></pre>
</div>
<div id="arguments" class="section level3">
<h3>arguments</h3>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="left">details</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>marketIds</code></td>
<td align="left"><em>string</em>, one or more marketIds, the number of markets returned depends on the amount of data you request via the <code>priceProjection</code></td>
</tr>
<tr class="even">
<td align="left"><code>priceProjection</code></td>
<td align="left">the projection of price data you want to receive in the response, options include <strong>SP_AVAILABLE</strong>, <strong>SP_TRADED</strong>, <strong>EX_BEST_OFFERS</strong>, <strong>EX_ALL_OFFERS</strong> (trumps EX_BEST_OFFERS), and <strong>EX_TRADED</strong>, these are expained in <a href="betting_enums.html#pricedata">Betting Enums</a> under the Price Data header.</td>
</tr>
<tr class="odd">
<td align="left"><code>orderProjection</code></td>
<td align="left">the order Projection you wish to receive in the response, <strong>ALL</strong> all orders (entirely matched, or not), <strong>EXECUTABLE</strong> orders with unmatched portion, <strong>EXECUTION_COMPLETE</strong> orders with no unmatched portion, see <a href="betting_enums.html#orderprojection">Betting Enums</a> under the Order Projection header.</td>
</tr>
<tr class="even">
<td align="left"><code>matchProjection</code></td>
<td align="left">if you ask for orders via <code>orderProjection</code>, this will specify the representation of the matched bets, options are <strong>NO_ROLLUP</strong> returns raw fragments, <strong>ROLLED_UP_BY_PRICE</strong> rolled up matched amounts by distinct matched prices per side, and <strong>ROLLED_UP_BY_AVG_PRICE</strong> rolled up by average price per side, see <a href="betting_enums.html#matchprojection">Betting Enums</a> under Match Projection header.</td>
</tr>
</tbody>
</table>
</div>
<div id="return" class="section level3">
<h3>return</h3>
<p>A list with 3 elements, there are two dataframes, one about the market, and one about the runners. The list also contains the raw response which may contain additional data that may be of interest. Some of this additional data could be market depth data if <strong>EX_ALL_OFFERS</strong> is entered into the <code>priceProjection</code> parameter. The list returned can be printed, allowing for quick glance at the market before users analyse the data further, or the list can be summarised.</p>
</div>
<div id="examples" class="section level3">
<h3>examples</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(betfaiR)
<span class="co"># login</span>
bf &lt;-<span class="st"> </span><span class="kw">betfair</span>(<span class="dt">usr =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_USR&quot;</span>),
              <span class="dt">pwd =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_PWD&quot;</span>),
              <span class="dt">key =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_KEY&quot;</span>))

<span class="co"># get market data on just one market</span>
tmp &lt;-<span class="st"> </span>bf$<span class="kw">marketCatalogue</span>(<span class="dt">filter =</span> <span class="kw">marketFilter</span>(<span class="dt">eventTypeIds =</span> <span class="dv">1</span>,
                                                <span class="dt">marketTypeCodes =</span> <span class="st">&quot;MATCH_ODDS&quot;</span>),
                          <span class="dt">marketProjection =</span> <span class="st">&quot;COMPETITION&quot;</span>,
                          <span class="dt">maxResults =</span> <span class="dv">10</span>)
<span class="kw">summary</span>(tmp)</code></pre>
<pre><code>
Market ID:      1.122170518
Event ID:       8555911 
Market Name:    Match Odds
Event Name:     FGF Campeonato U20 
Matched:        145.18
 ---------------------------------------------------------------------------
Market ID:      1.122168502
Event ID:       3729355 
Market Name:    Match Odds
Event Name:     Bolivian Liga Nacional A 
Matched:        26473.39
 ---------------------------------------------------------------------------
Market ID:      1.122181719
Event ID:       5627174 
Market Name:    Match Odds
Event Name:     Mexican Primera Division 
Matched:        43279.23
 ---------------------------------------------------------------------------
Market ID:      1.122181538
Event ID:       844197 
Market Name:    Match Odds
Event Name:     Colombian Primera A 
Matched:        11184.76
 ---------------------------------------------------------------------------
Market ID:      1.122181564
Event ID:       67387 
Market Name:    Match Odds
Event Name:     Argentinian Primera Division 
Matched:        11212.35
 ---------------------------------------------------------------------------
Market ID:      1.122183714
Event ID:       3781558 
Market Name:    Match Odds
Event Name:     Goa Professional League 
Matched:        0
 ---------------------------------------------------------------------------
Market ID:      1.122178071
Event ID:       5007039 
Market Name:    Match Odds
Event Name:     Mumbai Elite Division League 
Matched:        0
 ---------------------------------------------------------------------------
Market ID:      1.122177848
Event ID:       2356065 
Market Name:    Match Odds
Event Name:     Pirveli Liga 
Matched:        95.95
 ---------------------------------------------------------------------------
Market ID:      1.122177961
Event ID:       2356065 
Market Name:    Match Odds
Event Name:     Pirveli Liga 
Matched:        0
 ---------------------------------------------------------------------------
Market ID:      1.122177904
Event ID:       2356065 
Market Name:    Match Odds
Event Name:     Pirveli Liga 
Matched:        0
 ---------------------------------------------------------------------------</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># find market with most matched</span>
ind &lt;-<span class="st"> </span><span class="kw">which.max</span>(<span class="kw">sapply</span>(tmp, function(i) i$market$totalMatched))
market &lt;-<span class="st"> </span>tmp[[ind]]
<span class="kw">summary</span>(market)</code></pre>
<pre><code>
Market ID:      1.122181719
Event ID:       5627174 
Market Name:    Match Odds
Event Name:     Mexican Primera Division 
Matched:        43279.23
 ---------------------------------------------------------------------------</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">market &lt;-<span class="st"> </span>bf$<span class="kw">marketBook</span>(<span class="dt">marketIds =</span> market$market$marketId)
<span class="kw">summary</span>(market)</code></pre>
<pre><code>
Market ID:      1.122181719 
Matched:        44728.24 
Available:      7461.12

Runners:     3 
    .id selectionId handicap status lastPriceTraded totalMatched
 230914      230914        0 ACTIVE            4.40      8362.88
 328916      328916        0 ACTIVE            2.62     25990.65
  58805       58805        0 ACTIVE            2.54     10374.71

 ---------------------------------------------------------------------------</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># collect data on all 10 markets</span>
markets &lt;-<span class="st"> </span>bf$<span class="kw">marketBook</span>(<span class="dt">marketIds =</span> <span class="kw">sapply</span>(tmp, function(i) i$market$marketId))
<span class="kw">summary</span>(markets)</code></pre>
<pre><code>
Market ID:      1.122168502 
Matched:        28556.21 
Available:      5896.45

Runners:     3 
     .id selectionId handicap status lastPriceTraded totalMatched
 8858487     8858487        0 ACTIVE            2.88     17295.29
 7587365     7587365        0 ACTIVE            7.20      6484.65
   58805       58805        0 ACTIVE            1.95      4776.26

 ---------------------------------------------------------------------------
Market ID:      1.122170518 
Matched:        145.15 
Available:      205.28

Runners:     3 
     .id selectionId handicap status lastPriceTraded totalMatched
 5181675     5181675        0 ACTIVE            1.95       122.44
 5181429     5181429        0 ACTIVE            5.10         8.19
   58805       58805        0 ACTIVE            4.30        14.50

 ---------------------------------------------------------------------------
Market ID:      1.122177848 
Matched:        95.94 
Available:      1082.16

Runners:     3 
      .id selectionId handicap status lastPriceTraded totalMatched
 10194547    10194547        0 ACTIVE            1.52        22.82
  6865582     6865582        0 ACTIVE            3.50        69.68
    58805       58805        0 ACTIVE           14.00         3.44

 ---------------------------------------------------------------------------
Market ID:      1.122177904 
Matched:        0 
Available:      980.73

Runners:     3 
      .id selectionId handicap status totalMatched
 10165464    10165464        0 ACTIVE            0
  6881689     6881689        0 ACTIVE            0
    58805       58805        0 ACTIVE            0

 ---------------------------------------------------------------------------
Market ID:      1.122177961 
Matched:        0 
Available:      996.51

Runners:     3 
      .id selectionId handicap status totalMatched
 10255178    10255178        0 ACTIVE            0
  5667811     5667811        0 ACTIVE            0
    58805       58805        0 ACTIVE            0

 ---------------------------------------------------------------------------
Market ID:      1.122178071 
Matched:        0 
Available:      1758.66

Runners:     3 
     .id selectionId handicap status totalMatched
 3943270     3943270        0 ACTIVE            0
 9401036     9401036        0 ACTIVE            0
   58805       58805        0 ACTIVE            0

 ---------------------------------------------------------------------------
Market ID:      1.122181538 
Matched:        17216.73 
Available:      3163.34

Runners:     3 
     .id selectionId handicap status lastPriceTraded totalMatched
 1067444     1067444        0 ACTIVE            1.26     15493.61
 5615116     5615116        0 ACTIVE           18.00       982.22
   58805       58805        0 ACTIVE            6.40       740.89

 ---------------------------------------------------------------------------
Market ID:      1.122181564 
Matched:        12505.77 
Available:      3712.97

Runners:     3 
     .id selectionId handicap status lastPriceTraded totalMatched
 1213581     1213581        0 ACTIVE            6.00      5476.12
  194513      194513        0 ACTIVE            1.73      3571.91
   58805       58805        0 ACTIVE            3.65      3457.72

 ---------------------------------------------------------------------------
Market ID:      1.122181719 
Matched:        44728.24 
Available:      7461.12

Runners:     3 
    .id selectionId handicap status lastPriceTraded totalMatched
 230914      230914        0 ACTIVE            4.40      8362.88
 328916      328916        0 ACTIVE            2.62     25990.65
  58805       58805        0 ACTIVE            2.54     10374.71

 ---------------------------------------------------------------------------
Market ID:      1.122183714 
Matched:        0 
Available:      622.1

Runners:     3 
      .id selectionId handicap status totalMatched
  4427250     4427250        0 ACTIVE            0
 10302975    10302975        0 ACTIVE            0
    58805       58805        0 ACTIVE            0

 ---------------------------------------------------------------------------</code></pre>
<a href="https://github.com/durtal/betfaiR" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#d9230f; color:#fcfcfc; position: absolute; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
