<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>marketBook</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">

	/* padding for bootstrap navbar */
	body {
		padding-top: 20px;
		padding-bottom: 20px;
	}
	@media (max-width: 979px) {
		body {
			padding-top: 0;
		}
	}

	/* offset scroll position for anchor links (for fixed navbar) */
	@media (min-width: 980px) {
		.section h2 {
			padding-top: 52px;
			margin-top: -52px;
		}
		.section h3 {
			padding-top: 52px;
			margin-top: -52px;
		}
	}

	p {
		font-size: 13px;
	}

	/* don't use link color in navbar */
	.dropdown-menu>li>a {
		color: black;
	}

	/* some padding for disqus */
	#disqus_thread {
		margin-top: 45px;
	}

</style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<h1>betfaiR</h1>
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#betfaiR-nav">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://github.com/durtal" class="navbar-brand">durtal@github</a>
        </div>
        <div class="collapse navbar-collapse" id="betfaiR-nav">
            <ul class="nav navbar-nav">
                <li>
                    <a href="index.html">home</a>
                </li>
                <li class="dropdown">
                    <a href="Primary" class="dropdown-toggle" data-toggle="dropdown">
                        functions <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">environment</li>
                        <li>
                            <a href="betfair.html">betfair</a>
                        </li>
                        <li class="dropdown-header">functions</li>
                        <li>
                            <a href="betfair_login.html">bf_login</a>
                        </li>
                        <li>
                            <a href="bf_account.html">bf_account</a>
                        </li>
                        <li>
                            <a href="request_functions.html">bf_request</a>
                        </li>
                        <li>
                            <a href="betfair_POST.html">bf_post</a>
                        </li>
                        <li>
                            <a href="betfair_check.html">bf_check</a>
                        </li>
                        <li>
                            <a href="betfair_parse.html">bf_parse</a>
                        </li>
                        <li class="dropdown-header">helpers</li>
                        <li>
                            <a href="marketFilter.html">marketFilter</a>
                        </li>
                        <li>
                            <a href="bf_helpers.html">bet instructions</a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="Methods" class="dropdown-toggle" data-toggle="dropdown">
                        methods <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">summary data</li>
                        <li>
                            <a href="methods_competitions.html">competitions</a>
                        </li>
                        <li>
                            <a href="methods_countries.html">countries</a>
                        </li>
                        <li>
                            <a href="methods_events.html">events</a>
                        </li>
                        <li>
                            <a href="methods_eventTypes.html">eventTypes</a>
                        </li>
                        <li>
                            <a href="methods_venues.html">venues</a>
                        </li>
                        <li class="dropdown-header">login</li>
                        <li>
                            <a href="login_session.html">login + session</a>
                        </li>
                        <li class="dropdown-header">market data</li>
                        <li>
                            <a href="methods_marketTypes.html">marketTypes</a>
                        </li>
                        <li>
                            <a href="methods_marketCatalogue.html">marketCatalogue</a>
                        </li>
                        <li>
                            <a href="methods_marketBook.html">marketBook</a>
                        </li>
                        <li>
                            <a href="methods_marketPnL.html">marketPnL</a>
                        </li>
                        <li class="dropdown-header">orders</li>
                        <li>
                            <a href="cancelOrders.html">cancelOrders</a>
                        </li>
                        <li>
                            <a href="clearedOrders.html">clearedOrders</a>
                        </li>
                        <li>
                            <a href="currentOrders.html">currentOrders</a>
                        </li>
                        <li>
                            <a href="placeOrders.html">placeOrders</a>
                        </li>
                        <li>
                            <a href="replaceOrders.html">replaceOrders</a>
                        </li>
                        <li>
                            <a href="updateOrders.html">updateOrders</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="Misc" class="dropdown-toggle" data-toggle="dropdown">
                        misc <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="betting_enums.html">Betting Enums</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="vignettes" class="dropdown-toggle" data-toggle="dropdown">
                        vignettes <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="vignette_one.html">place a bet</a>
                        </li>
                        <li>
                            <a href="vignette_two.html">cron jobs w/ betfaiR (pt.1)</a>
                        </li>
                        <li>
                            <a href="vignette_three.html">betfair super sunday (pt.2)</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div id="header">
<h1 class="title">marketBook</h1>
</div>


<p><strong>This method still might require some work, especially in parsing the response from Betfair.</strong></p>
<p>Having logged in using the <a href="betfair.html"><code>betfair</code></a> function, the environment contains the <code>marketBook</code> method, which can be used to get market data. You can use <code>marketBook</code> to retrieve data about the market, but more importantly the price data for the various runners in the market.</p>
<div id="usage" class="section level3">
<h3>usage</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bf$<span class="kw">marketBook</span>(<span class="dt">marketIds =</span> <span class="kw">list</span>(),
              <span class="dt">priceProjection =</span> <span class="st">&quot;EX_BEST_OFFERS&quot;</span>,
              <span class="dt">orderProjection =</span> <span class="st">&quot;EXECUTABLE&quot;</span>,
              <span class="dt">matchProjection =</span> <span class="st">&quot;NO_ROLLUP&quot;</span>)</code></pre></div>
</div>
<div id="arguments" class="section level3">
<h3>arguments</h3>
<table style="width:112%;">
<colgroup>
<col width="9%" />
<col width="102%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="left">details</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>marketIds</code></td>
<td align="left"><em>string</em>, one or more marketIds, the number of markets returned depends on the amount of data you request via the <code>priceProjection</code></td>
</tr>
<tr class="even">
<td align="left"><code>priceProjection</code></td>
<td align="left">the projection of price data you want to receive in the response, options include <strong>SP_AVAILABLE</strong>, <strong>SP_TRADED</strong>, <strong>EX_BEST_OFFERS</strong>, <strong>EX_ALL_OFFERS</strong> (trumps EX_BEST_OFFERS), and <strong>EX_TRADED</strong>, these are expained in <a href="betting_enums.html#pricedata">Betting Enums</a> under the Price Data header.</td>
</tr>
<tr class="odd">
<td align="left"><code>orderProjection</code></td>
<td align="left">the order Projection you wish to receive in the response, <strong>ALL</strong> all orders (entirely matched, or not), <strong>EXECUTABLE</strong> orders with unmatched portion, <strong>EXECUTION_COMPLETE</strong> orders with no unmatched portion, see <a href="betting_enums.html#orderprojection">Betting Enums</a> under the Order Projection header.</td>
</tr>
<tr class="even">
<td align="left"><code>matchProjection</code></td>
<td align="left">if you ask for orders via <code>orderProjection</code>, this will specify the representation of the matched bets, options are <strong>NO_ROLLUP</strong> returns raw fragments, <strong>ROLLED_UP_BY_PRICE</strong> rolled up matched amounts by distinct matched prices per side, and <strong>ROLLED_UP_BY_AVG_PRICE</strong> rolled up by average price per side, see <a href="betting_enums.html#matchprojection">Betting Enums</a> under Match Projection header.</td>
</tr>
</tbody>
</table>
</div>
<div id="return" class="section level3">
<h3>return</h3>
<p>A list with 3 elements, there are two dataframes, one about the market, and one about the runners. The list also contains the raw response which may contain additional data that may be of interest. Some of this additional data could be market depth data if <strong>EX_ALL_OFFERS</strong> is entered into the <code>priceProjection</code> parameter. The list returned can be printed, allowing for quick glance at the market before users analyse the data further, or the list can be summarised.</p>
</div>
<div id="examples" class="section level3">
<h3>examples</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(betfaiR)
<span class="co"># login</span>
bf &lt;-<span class="st"> </span><span class="kw">betfair</span>(<span class="dt">usr =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_USR&quot;</span>),
              <span class="dt">pwd =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_PWD&quot;</span>),
              <span class="dt">key =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_KEY&quot;</span>))</code></pre></div>
<pre><code>Login successful</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># get market data on just one market</span>
tmp &lt;-<span class="st"> </span>bf$<span class="kw">marketCatalogue</span>(<span class="dt">filter =</span> <span class="kw">marketFilter</span>(<span class="dt">eventTypeIds =</span> <span class="dv">1</span>,
                                                <span class="dt">marketTypeCodes =</span> <span class="st">&quot;MATCH_ODDS&quot;</span>),
                          <span class="dt">marketProjection =</span> <span class="st">&quot;COMPETITION&quot;</span>,
                          <span class="dt">maxResults =</span> <span class="dv">10</span>)
<span class="kw">summary</span>(tmp)</code></pre></div>
<pre><code>
Market ID:      1.123022122
Event ID:       61 
Market Name:    Match Odds
Event Name:     Bundesliga 2 
Matched:        311698.72
 ---------------------------------------------------------------------------
Market ID:      1.123022199
Event ID:       61 
Market Name:    Match Odds
Event Name:     Bundesliga 2 
Matched:        174596.41
 ---------------------------------------------------------------------------
Market ID:      1.123022045
Event ID:       61 
Market Name:    Match Odds
Event Name:     Bundesliga 2 
Matched:        496396.49
 ---------------------------------------------------------------------------
Market ID:      1.123136096
Event ID:       827078 
Market Name:    Match Odds
Event Name:     Mexican U20 League 
Matched:        1261.22
 ---------------------------------------------------------------------------
Market ID:      1.123023279
Event ID:       194215 
Market Name:    Match Odds
Event Name:     Turkish Super League 
Matched:        49456.97
 ---------------------------------------------------------------------------
Market ID:      1.123019873
Event ID:       158146 
Market Name:    Match Odds
Event Name:     3. Liga 
Matched:        12595.83
 ---------------------------------------------------------------------------
Market ID:      1.123134757
Event ID:       8616348 
Market Name:    Match Odds
Event Name:     Friendly 
Matched:        2724.79
 ---------------------------------------------------------------------------
Market ID:      1.123020968
Event ID:       8139939 
Market Name:    Match Odds
Event Name:     Eredivisie (W) 
Matched:        3296.74
 ---------------------------------------------------------------------------
Market ID:      1.123051623
Event ID:       840808 
Market Name:    Match Odds
Event Name:     Regionalliga West 
Matched:        6453.99
 ---------------------------------------------------------------------------
Market ID:      1.123051735
Event ID:       840808 
Market Name:    Match Odds
Event Name:     Regionalliga West 
Matched:        2868.7
 ---------------------------------------------------------------------------</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># find market with most matched</span>
ind &lt;-<span class="st"> </span><span class="kw">which.max</span>(<span class="kw">sapply</span>(tmp, function(i) i$market$totalMatched))
market &lt;-<span class="st"> </span>tmp[[ind]]
<span class="kw">summary</span>(market)</code></pre></div>
<pre><code>
Market ID:      1.123022045
Event ID:       61 
Market Name:    Match Odds
Event Name:     Bundesliga 2 
Matched:        496396.49
 ---------------------------------------------------------------------------</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">market &lt;-<span class="st"> </span>bf$<span class="kw">marketBook</span>(<span class="dt">marketIds =</span> market$market$marketId)
<span class="kw">summary</span>(market)</code></pre></div>
<pre><code>
Market ID:      1.123022045 
Matched:        535437.38 
Available:      12824.62

Runners:     3 
    .id selectionId handicap status lastPriceTraded totalMatched
  64375       64375        0 ACTIVE            3.65    354277.04
 210943      210943        0 ACTIVE           21.00    109884.46
  58805       58805        0 ACTIVE            1.48     71275.87

 ---------------------------------------------------------------------------</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># collect data on all 10 markets</span>
markets &lt;-<span class="st"> </span>bf$<span class="kw">marketBook</span>(<span class="dt">marketIds =</span> <span class="kw">sapply</span>(tmp, function(i) i$market$marketId))
<span class="kw">summary</span>(markets)</code></pre></div>
<pre><code>
Market ID:      1.123019873 
Matched:        12791.46 
Available:      8748.38

Runners:     3 
    .id selectionId handicap status lastPriceTraded totalMatched
 498562      498562        0 ACTIVE            5.50      5221.51
 247830      247830        0 ACTIVE            3.20      5177.48
  58805       58805        0 ACTIVE            2.04      2392.45

 ---------------------------------------------------------------------------
Market ID:      1.123020968 
Matched:        11382.44 
Available:      12852.19

Runners:     3 
     .id selectionId handicap status lastPriceTraded totalMatched
 5272256     5272256        0 ACTIVE            1.01     11179.78
 5943510     5943510        0 ACTIVE          300.00       120.43
   58805       58805        0 ACTIVE          130.00        82.22

 ---------------------------------------------------------------------------
Market ID:      1.123022045 
Matched:        535437.38 
Available:      12824.62

Runners:     3 
    .id selectionId handicap status lastPriceTraded totalMatched
  64375       64375        0 ACTIVE            3.65    354277.04
 210943      210943        0 ACTIVE           21.00    109884.46
  58805       58805        0 ACTIVE            1.48     71275.87

 ---------------------------------------------------------------------------
Market ID:      1.123022122 
Matched:        343235.26 
Available:      43722.98

Runners:     3 
     .id selectionId handicap status lastPriceTraded totalMatched
   44526       44526        0 ACTIVE          400.00     51209.53
 2486890     2486890        0 ACTIVE            1.02    276080.81
   58805       58805        0 ACTIVE           55.00     15944.91

 ---------------------------------------------------------------------------
Market ID:      1.123022199 
Matched:        174567.67 
Available:      25223.88

Runners:     3 
     .id selectionId handicap status lastPriceTraded totalMatched
 5340398     5340398        0 ACTIVE            1.01    156114.57
   50347       50347        0 ACTIVE         1000.00      7844.49
   58805       58805        0 ACTIVE          920.00     10608.60

 ---------------------------------------------------------------------------
Market ID:      1.123023279 
Matched:        50350.66 
Available:      11202.88

Runners:     3 
     .id selectionId handicap status lastPriceTraded totalMatched
 6553233     6553233        0 ACTIVE            1.36     34735.36
  508773      508773        0 ACTIVE           18.00      8734.80
   58805       58805        0 ACTIVE            4.80      6880.49

 ---------------------------------------------------------------------------
Market ID:      1.123051623 
Matched:        6452.08 
Available:      1257.54

Runners:     3 
    .id selectionId handicap status lastPriceTraded totalMatched
 498547      498547        0 ACTIVE            2.18      3069.36
 516223      516223        0 ACTIVE            3.60      2316.49
  58805       58805        0 ACTIVE            3.75      1066.22

 ---------------------------------------------------------------------------
Market ID:      1.123051735 
Matched:        2867.88 
Available:      1040.28

Runners:     3 
     .id selectionId handicap status lastPriceTraded totalMatched
 3235339     3235339        0 ACTIVE           15.50       292.52
 1550976     1550976        0 ACTIVE            1.25      2354.62
   58805       58805        0 ACTIVE            7.20       220.73

 ---------------------------------------------------------------------------
Market ID:      1.123134757 
Matched:        2752.24 
Available:      3004.13

Runners:     3 
     .id selectionId handicap status lastPriceTraded totalMatched
  180590      180590        0 ACTIVE            2.52       920.87
 5549837     5549837        0 ACTIVE            4.30       476.72
   58805       58805        0 ACTIVE            2.40      1354.63

 ---------------------------------------------------------------------------
Market ID:      1.123136096 
Matched:        1342.95 
Available:      1174.9

Runners:     3 
     .id selectionId handicap status lastPriceTraded totalMatched
 5253684     5253684        0 ACTIVE            3.05      1280.93
 6122226     6122226        0 ACTIVE            4.20         7.96
   58805       58805        0 ACTIVE            2.40        54.06

 ---------------------------------------------------------------------------</code></pre>
<a href="https://github.com/durtal/betfaiR" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#d9230f; color:#fcfcfc; position: absolute; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
