<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>marketBook</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">

	/* padding for bootstrap navbar */
	body {
		padding-top: 20px;
		padding-bottom: 20px;
	}
	@media (max-width: 979px) {
		body {
			padding-top: 0;
		}
	}

	/* offset scroll position for anchor links (for fixed navbar) */
	@media (min-width: 980px) {
		.section h2 {
			padding-top: 52px;
			margin-top: -52px;
		}
		.section h3 {
			padding-top: 52px;
			margin-top: -52px;
		}
	}

	p {
		font-size: 13px;
	}

	/* don't use link color in navbar */
	.dropdown-menu>li>a {
		color: black;
	}

	/* some padding for disqus */
	#disqus_thread {
		margin-top: 45px;
	}

</style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<h1>betfaiR</h1>
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#betfaiR-nav">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://github.com/durtal" class="navbar-brand">durtal@github</a>
        </div>
        <div class="collapse navbar-collapse" id="betfaiR-nav">
            <ul class="nav navbar-nav">
                <li>
                    <a href="index.html">home</a>
                </li>
                <li class="dropdown">
                    <a href="Primary" class="dropdown-toggle" data-toggle="dropdown">
                        Functions <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">Environment</li>
                        <li>
                            <a href="betfair.html">betfair</a>
                        </li>
                        <li class="dropdown-header">Helpers</li>
                        <li>
                            <a href="marketFilter.html">marketFilter</a>
                        </li>
                        <li>
                            <a href="betfair_login.html">betfair_login</a>
                        </li>
                        <li>
                            <a href="request_functions.html">requests</a>
                        </li>
                        <li>
                            <a href="betfair_POST.html">betfair_POST</a>
                        </li>
                        <li>
                            <a href="betfair_check.html">betfair_check</a>
                        </li>
                        <li>
                            <a href="betfair_parse.html">betfair_parse</a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="Methods" class="dropdown-toggle" data-toggle="dropdown">
                        Methods <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="methods_competitions.html">competitions</a>
                        </li>
                        <li>
                            <a href="methods_countries.html">countries</a>
                        </li>
                        <li>
                            <a href="methods_events.html">events</a>
                        </li>
                        <li>
                            <a href="methods_eventTypes.html">eventTypes</a>
                        </li>
                        <li>
                            <a href="login_session.html">login + session</a>
                        </li>
                        <li>
                            <a href="methods_marketBook.html">marketBook</a>
                        </li>
                        <li>
                            <a href="methods_marketCatalogue.html">marketCatalogue</a>
                        </li>
                        <li>
                            <a href="methods_marketTypes.html">marketTypes</a>
                        </li>
                        <li>
                            <a href="methods_venues.html">venues</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="Misc" class="dropdown-toggle" data-toggle="dropdown">
                        Misc <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="betting_enums.html">Betting Enums</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="http://www.github.com/durtal/betfaiR"> <i class="fa fa-github-square fa-lg"></i></a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div id="header">
<h1 class="title">marketBook</h1>
</div>


<p><strong>This method still might require some work, especially in parsing the response from Betfair.</strong></p>
<p>Having logged in using the <a href="betfair.html"><code>betfair</code></a> function, the environment contains the <code>marketBook</code> method, which can be used to get market data. You can use <code>marketBook</code> to retrieve data about the market, but more importantly the price data for the various runners in the market.</p>
<div id="usage" class="section level3">
<h3>usage</h3>
<pre class="sourceCode r"><code class="sourceCode r">bf$<span class="kw">marketBook</span>(<span class="dt">marketIds =</span> <span class="kw">list</span>(),
              <span class="dt">priceProjection =</span> <span class="st">&quot;EX_BEST_OFFERS&quot;</span>,
              <span class="dt">orderProjection =</span> <span class="st">&quot;EXECUTABLE&quot;</span>,
              <span class="dt">matchProjection =</span> <span class="st">&quot;NO_ROLLUP&quot;</span>)</code></pre>
</div>
<div id="arguments" class="section level3">
<h3>arguments</h3>
<table>
<thead>
<tr class="header">
<th align="left">param</th>
<th align="left">details</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>marketIds</code></td>
<td align="left"><em>string</em>, one or more marketIds, the number of markets returned depends on the amount of data you request via the <code>priceProjection</code></td>
</tr>
<tr class="even">
<td align="left"><code>priceProjection</code></td>
<td align="left">the projection of price data you want to receive in the response, options include <strong>SP_AVAILABLE</strong>, <strong>SP_TRADED</strong>, <strong>EX_BEST_OFFERS</strong>, <strong>EX_ALL_OFFERS</strong> (trumps EX_BEST_OFFERS), and <strong>EX_TRADED</strong>, these are expained in <a href="betting_enums.html#pricedata">Betting Enums</a> under the Price Data header.</td>
</tr>
<tr class="odd">
<td align="left"><code>orderProjection</code></td>
<td align="left">the order Projection you wish to receive in the response, <strong>ALL</strong> all orders (entirely matched, or not), <strong>EXECUTABLE</strong> orders with unmatched portion, <strong>EXECUTION_COMPLETE</strong> orders with no unmatched portion, see <a href="betting_enums.html#orderprojection">Betting Enums</a> under the Order Projection header.</td>
</tr>
<tr class="even">
<td align="left"><code>matchProjection</code></td>
<td align="left">if you ask for orders via <code>orderProjection</code>, this will specify the representation of the matched bets, options are <strong>NO_ROLLUP</strong> returns raw fragments, <strong>ROLLED_UP_BY_PRICE</strong> rolled up matched amounts by distinct matched prices per side, and <strong>ROLLED_UP_BY_AVG_PRICE</strong> rolled up by average price per side, see <a href="betting_enums.html#matchprojection">Betting Enums</a> under Match Projection header.</td>
</tr>
</tbody>
</table>
</div>
<div id="return" class="section level3">
<h3>return</h3>
<p>A list with 3 elements, there are two dataframes, one about the market, and one about the runners. The list also contains the raw response which may contain additional data that may be of interest. Some of this additional data could be market depth data if <strong>EX_ALL_OFFERS</strong> is entered into the <code>priceProjection</code> parameter. The list returned can be printed, allowing for quick glance at the market before users analyse the data further, or the list can be summarised.</p>
</div>
<div id="examples" class="section level3">
<h3>examples</h3>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(betfaiR)
<span class="co"># login</span>
bf &lt;-<span class="st"> </span><span class="kw">betfair</span>(<span class="dt">usr =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_USR&quot;</span>),
              <span class="dt">pwd =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_PWD&quot;</span>),
              <span class="dt">key =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_KEY&quot;</span>))

<span class="co"># get market data on just one market</span>
tmp &lt;-<span class="st"> </span>bf$<span class="kw">marketCatalogue</span>(<span class="dt">filter =</span> <span class="kw">marketFilter</span>(<span class="dt">eventTypeIds =</span> <span class="dv">1</span>,
                                                <span class="dt">marketTypeCodes =</span> <span class="st">&quot;MATCH_ODDS&quot;</span>),
                          <span class="dt">marketProjection =</span> <span class="st">&quot;COMPETITION&quot;</span>,
                          <span class="dt">maxResults =</span> <span class="dv">10</span>)
<span class="kw">summary</span>(tmp)</code></pre>
<pre><code>
Market ID:      1.121876951
Event ID:       821269 
Market Name:    Match Odds
Event Name:     Tercera Division 
Matched:        12207.2
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121971595
Event ID:       801976 
Market Name:    Match Odds
Event Name:     Egyptian Premier 
Matched:        3645.47
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121686076
Event ID:       2005 
Market Name:    Match Odds
Event Name:     UEFA Europa League 
Matched:        431238.03
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121686385
Event ID:       2005 
Market Name:    Match Odds
Event Name:     UEFA Europa League 
Matched:        89618.91
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121687019
Event ID:       2005 
Market Name:    Match Odds
Event Name:     UEFA Europa League 
Matched:        456086.4
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121686179
Event ID:       2005 
Market Name:    Match Odds
Event Name:     UEFA Europa League 
Matched:        246725.33
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121876676 
Market Name:    Match Odds 
Matched:        1016
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121686593
Event ID:       2005 
Market Name:    Match Odds
Event Name:     UEFA Europa League 
Matched:        46795.28
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121876896
Event ID:       8530026 
Market Name:    Match Odds
Event Name:     UEFA Womens Euro Qualifying 
Matched:        12193.32
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121756673
Event ID:       2005 
Market Name:    Match Odds
Event Name:     UEFA Europa League 
Matched:        86911.62
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># find market with most matched</span>
ind &lt;-<span class="st"> </span><span class="kw">which.max</span>(<span class="kw">sapply</span>(tmp, function(i) i$market$totalMatched))
market &lt;-<span class="st"> </span>tmp[[ind]]
<span class="kw">summary</span>(market)</code></pre>
<pre><code>
Market ID:      1.121687019
Event ID:       2005 
Market Name:    Match Odds
Event Name:     UEFA Europa League 
Matched:        456086.4
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">market &lt;-<span class="st"> </span>bf$<span class="kw">marketBook</span>(<span class="dt">marketIds =</span> market$market$marketId)
<span class="kw">summary</span>(market)</code></pre>
<pre><code>
Market ID:      1.121687019 
Matched:        478609.87 
Available:      113481.83

Runners:
     .id selectionId handicap status lastPriceTraded totalMatched
   50335       50335        0 ACTIVE            1.75    448049.28
 1209582     1209582        0 ACTIVE           12.50     10781.72
   58805       58805        0 ACTIVE            2.80     19778.86

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># collect data on all 10 markets</span>
markets &lt;-<span class="st"> </span>bf$<span class="kw">marketBook</span>(<span class="dt">marketIds =</span> <span class="kw">sapply</span>(tmp, function(i) i$market$marketId))
<span class="kw">summary</span>(markets)</code></pre>
<pre><code>
Market ID:      1.121686076 
Matched:        534372.21 
Available:      76022.08

Runners:
     .id selectionId handicap status lastPriceTraded totalMatched
 2939090     2939090        0 ACTIVE           12.00     56029.72
  676467      676467        0 ACTIVE            1.52    406736.50
   58805       58805        0 ACTIVE            3.95     71605.98

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121686179 
Matched:        253316.16 
Available:      33925.1

Runners:
     .id selectionId handicap status lastPriceTraded totalMatched
 3631356     3631356        0 ACTIVE            2.16    207054.69
   46980       46980        0 ACTIVE           11.50     21748.14
   58805       58805        0 ACTIVE            2.22     24513.32

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121686385 
Matched:        105872.21 
Available:      83153.64

Runners:
     .id selectionId handicap status lastPriceTraded totalMatched
  110475      110475        0 ACTIVE            1.15     96287.17
 1300930     1300930        0 ACTIVE           60.00      4079.76
   58805       58805        0 ACTIVE            9.20      5505.27

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121686593 
Matched:        50228.87 
Available:      32329.03

Runners:
    .id selectionId handicap status lastPriceTraded totalMatched
  48786       48786        0 ACTIVE            4.20     11850.95
 502303      502303        0 ACTIVE            4.20     16148.13
  58805       58805        0 ACTIVE            1.92     22229.78

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121687019 
Matched:        478609.87 
Available:      112367.6

Runners:
     .id selectionId handicap status lastPriceTraded totalMatched
   50335       50335        0 ACTIVE            1.75    448049.28
 1209582     1209582        0 ACTIVE           12.50     10781.72
   58805       58805        0 ACTIVE            2.80     19778.86

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121756673 
Matched:        97780.69 
Available:      30598.81

Runners:
    .id selectionId handicap status lastPriceTraded totalMatched
 498560      498560        0 ACTIVE            1.37     23836.97
 215903      215903        0 ACTIVE           18.00     49225.60
  58805       58805        0 ACTIVE            4.50     24718.12

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121876676 
Matched:        1144.33 
Available:      10675.21

Runners:
      .id selectionId handicap status lastPriceTraded totalMatched
  4835198     4835198        0 ACTIVE            1.21       796.62
 10533628    10533628        0 ACTIVE           36.00       127.19
    58805       58805        0 ACTIVE            7.00       220.50

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121876896 
Matched:        15102.69 
Available:      14049.43

Runners:
     .id selectionId handicap status lastPriceTraded totalMatched
 5908461     5908461        0 ACTIVE           60.00       835.05
  727766      727766        0 ACTIVE            1.13     13949.83
   58805       58805        0 ACTIVE           10.50       317.80

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121876951 
Matched:        13753.58 
Available:      895.75

Runners:
     .id selectionId handicap status lastPriceTraded totalMatched
 9053708     9053708        0 ACTIVE            9.00      6969.59
 6415551     6415551        0 ACTIVE           11.00      2852.55
   58805       58805        0 ACTIVE            1.25      3931.43

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -
Market ID:      1.121971595 
Matched:        3642.83 
Available:      656.84

Runners:
     .id selectionId handicap status lastPriceTraded totalMatched
 5907009     5907009        0 ACTIVE            2.50      1591.45
 7024303     7024303        0 ACTIVE            3.65      1510.97
   58805       58805        0 ACTIVE            3.25       540.41

 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</code></pre>
<a href="https://github.com/durtal/betfaiR" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#d9230f; color:#fcfcfc; position: absolute; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
