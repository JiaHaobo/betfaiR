<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<title>cron jobs w/ betfaiR</title>

<script src="libs/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.1/css/united.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.1/shim/respond.min.js"></script>
<style type="text/css">

	/* padding for bootstrap navbar */
	body {
		padding-top: 20px;
		padding-bottom: 20px;
	}
	@media (max-width: 979px) {
		body {
			padding-top: 0;
		}
	}

	/* offset scroll position for anchor links (for fixed navbar) */
	@media (min-width: 980px) {
		.section h2 {
			padding-top: 52px;
			margin-top: -52px;
		}
		.section h3 {
			padding-top: 52px;
			margin-top: -52px;
		}
	}

	p {
		font-size: 13px;
	}

	/* don't use link color in navbar */
	.dropdown-menu>li>a {
		color: black;
	}

	/* some padding for disqus */
	#disqus_thread {
		margin-top: 45px;
	}

</style>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">

<h1>betfaiR</h1>
<nav class="navbar navbar-inverse">
    <div class="container-fluid">
        <div class="navbar-header">
            <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#betfaiR-nav">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="https://github.com/durtal" class="navbar-brand">durtal@github</a>
        </div>
        <div class="collapse navbar-collapse" id="betfaiR-nav">
            <ul class="nav navbar-nav">
                <li>
                    <a href="index.html">home</a>
                </li>
                <li class="dropdown">
                    <a href="Primary" class="dropdown-toggle" data-toggle="dropdown">
                        functions <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">environment</li>
                        <li>
                            <a href="betfair.html">betfair</a>
                        </li>
                        <li class="dropdown-header">functions</li>
                        <li>
                            <a href="betfair_login.html">bf_login</a>
                        </li>
                        <li>
                            <a href="bf_account.html">bf_account</a>
                        </li>
                        <li>
                            <a href="request_functions.html">bf_request</a>
                        </li>
                        <li>
                            <a href="betfair_POST.html">bf_post</a>
                        </li>
                        <li>
                            <a href="betfair_check.html">bf_check</a>
                        </li>
                        <li>
                            <a href="betfair_parse.html">bf_parse</a>
                        </li>
                        <li class="dropdown-header">helpers</li>
                        <li>
                            <a href="marketFilter.html">marketFilter</a>
                        </li>
                        <li>
                            <a href="bf_helpers.html">bet instructions</a>
                        </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="Methods" class="dropdown-toggle" data-toggle="dropdown">
                        methods <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li class="dropdown-header">summary data</li>
                        <li>
                            <a href="methods_competitions.html">competitions</a>
                        </li>
                        <li>
                            <a href="methods_countries.html">countries</a>
                        </li>
                        <li>
                            <a href="methods_events.html">events</a>
                        </li>
                        <li>
                            <a href="methods_eventTypes.html">eventTypes</a>
                        </li>
                        <li>
                            <a href="methods_venues.html">venues</a>
                        </li>
                        <li class="dropdown-header">login</li>
                        <li>
                            <a href="login_session.html">login + session</a>
                        </li>
                        <li class="dropdown-header">market data</li>
                        <li>
                            <a href="methods_marketTypes.html">marketTypes</a>
                        </li>
                        <li>
                            <a href="methods_marketCatalogue.html">marketCatalogue</a>
                        </li>
                        <li>
                            <a href="methods_marketBook.html">marketBook</a>
                        </li>
                        <li>
                            <a href="methods_marketPnL.html">marketPnL</a>
                        </li>
                        <li class="dropdown-header">orders</li>
                        <li>
                            <a href="cancelOrders.html">cancelOrders</a>
                        </li>
                        <li>
                            <a href="clearedOrders.html">clearedOrders</a>
                        </li>
                        <li>
                            <a href="currentOrders.html">currentOrders</a>
                        </li>
                        <li>
                            <a href="placeOrders.html">placeOrders</a>
                        </li>
                        <li>
                            <a href="replaceOrders.html">replaceOrders</a>
                        </li>
                        <li>
                            <a href="updateOrders.html">updateOrders</a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="Misc" class="dropdown-toggle" data-toggle="dropdown">
                        misc <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="betting_enums.html">Betting Enums</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li class="dropdown">
                    <a href="vignettes" class="dropdown-toggle" data-toggle="dropdown">
                        vignettes <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        <li>
                            <a href="vignette_one.html">place a bet</a>
                        </li>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div id="header">
<h1 class="title">cron jobs w/ betfaiR</h1>
</div>


<p>This vignette will walk through the (theoretical) use of <code>betfaiR</code> to collect data over time - this will be useful for collecting data about markets, to potentially build models and establish trading strategies. I will try to explain how to perform similar tasks on both Windows and Linux/OSX machines, this will involve creating an R script and using a Task scheduler (Task Scheduler on Windows and <a href="https://en.wikipedia.org/wiki/Cron">cron</a> on Linux/OSX). As an example, the plot below shows the Betfair odds during the course of a football game between Manchester United and Manchester City:</p>
<p><img src="manchester-derby.jpeg" style="display: block; margin-left: auto; margin-right: auto"></p>
<p>There are a few things that we will need to do:</p>
<ul>
<li>to create an R script that will use changing variables
<ul>
<li>variables will be the marketIds which will change day to day</li>
</ul></li>
<li>to store data in .RDS or RData files, data will include
<ul>
<li>marketId</li>
<li>returned market data</li>
</ul></li>
</ul>
<div id="find-markets" class="section level2">
<h2>Find markets</h2>
<p>First, some familiarity with events, competitions, and markets will help with creating an R script to automate the collection of data. We will try to collect match odds data for Premier League matches. We will need the competition id for these markets.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># load betfaiR and login</span>
<span class="kw">library</span>(betfaiR)
bf &lt;-<span class="st"> </span><span class="kw">betfair</span>(<span class="dt">usr =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_USR&quot;</span>),
              <span class="dt">pwd =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_PWD&quot;</span>),
              <span class="dt">key =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_KEY&quot;</span>))</code></pre>
<pre><code>Login successful</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># find correct eventTypeIds</span>
(eventTypeIds &lt;-<span class="st"> </span>bf$<span class="kw">eventTypes</span>())</code></pre>
<pre><code>   eventType_id     eventType_name marketCount
1        468328           Handball          39
2             1             Soccer       14011
3             2             Tennis        2112
4       2378961           Politics          42
5             3               Golf          58
6          6231     Financial Bets           3
7        998917         Volleyball          24
8             4            Cricket         386
9             5        Rugby Union         113
10            6             Boxing          30
11            7       Horse Racing         395
12            8        Motor Sport           5
13         7524         Ice Hockey         194
14     27589895      Olympics 2016           1
15           10       Special Bets          79
16           11            Cycling           6
17       451485      Winter Sports           9
18     26420387 Mixed Martial Arts         132
19         3503              Darts          14
20       136332              Chess          14
21         7522         Basketball         489
22         1477       Rugby League          37
23      2152880       Gaelic Games           4
24         6422            Snooker          42
25         6423  American Football         113
26         7511           Baseball           1
27         4339   Greyhound Racing         148</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># soccer/football has eventTypeId of 1, lets use that along with marketCountries to find the Premier League competition</span>
(competitions &lt;-<span class="st"> </span>bf$<span class="kw">competitions</span>(<span class="dt">filter =</span> <span class="kw">marketFilter</span>(<span class="dt">eventTypeIds =</span> <span class="dv">1</span>,
                                                       <span class="dt">marketCountries =</span> <span class="st">&quot;GB&quot;</span>)))</code></pre>
<pre><code>   competition_id                           competition_name marketCount
1           30558                             English FA Cup         109
2            2134                            Capital One Cup          14
3          299924                                  Welsh Cup           6
4         5808320                    SPFL Development League          44
5           20351                           NIFL Premiership          10
6         6011072                  SPFL Development League 2          66
7         7129730                           The Championship         122
8         4644728 Northern Premier League Division One North          22
9         4596912                Isthmian Division One North          22
10             31                    Barclays Premier League         356
11          24789                    Johnstones Paint Trophy           1
12             35                                 League One         235
13         409743                               Scottish Cup         107
14             39                            National League          33
15         252549                       Welsh Premier League          12
16             37                                 League Two         125
17        4540650                        NIFL Reserve League          22
18            111                        Scottish League Two          11
19             43                      National League South          50
20             41                      National League North          24
21            109                        Scottish League One          13
22            107                      Scottish Championship          13
23            105                       Scottish Premiership          64
24        2129602            Professional Development League          86
25         820588                           Southern Premier          58
26        3784863                          UEFA Youth League           5
27         820753                           Northern Premier          14
28        2608550                                   Specials           6
29          42886                                  FA Trophy           2
30         820582                           Isthmian Premier          12
   competitionRegion
1                GBR
2                GBR
3                GBR
4                GBR
5                GBR
6                GBR
7                GBR
8                GBR
9                GBR
10               GBR
11               GBR
12               GBR
13               GBR
14               GBR
15               GBR
16               GBR
17               GBR
18               GBR
19               GBR
20               GBR
21               GBR
22               GBR
23               GBR
24               GBR
25               GBR
26     International
27               GBR
28               GBR
29               GBR
30               GBR</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># the Premier League has a competition id of 31, we can find the different market types for this competition</span>
(marketTypes &lt;-<span class="st"> </span>bf$<span class="kw">marketTypes</span>(<span class="dt">filter =</span> <span class="kw">marketFilter</span>(<span class="dt">competitionIds =</span> <span class="dv">31</span>)))</code></pre>
<pre><code>             marketType marketCount
1                UNUSED          18
2               SPECIAL          18
3              HANDICAP           2
4      UNDIFFERENTIATED           2
5          TOP_N_FINISH           1
6           ROCK_BOTTOM           1
7        TOP_GOALSCORER           2
8                WINNER           1
9        DAILY_SPECIALS           2
10      NEXT_GOALSCORER          16
11      WIN_BOTH_HALVES           4
12          DRAW_NO_BET           2
13  BOTH_TEAMS_TO_SCORE          12
14            NEXT_GOAL           2
15           SCORE_CAST           2
16        OVER_UNDER_35          12
17        OVER_UNDER_15          12
18          TOTAL_GOALS           2
19        OVER_UNDER_45          12
20      WIN_FROM_BEHIND           4
21             WIN_HALF           4
22      RACE_TO_3_GOALS           2
23             TO_SCORE           2
24            HALF_TIME          12
25      RACE_TO_2_GOALS           2
26  OVER_UNDER_65_CARDS           2
27         BOOKING_ODDS           2
28              WINCAST           4
29      HALF_TIME_SCORE          12
30        CORRECT_SCORE          12
31 MATCH_ODDS_AND_OU_25           2
32        OVER_UNDER_25          12
33             TEAM_A_1           2
34             TEAM_A_3           2
35  HALF_TIME_FULL_TIME          12
36             TEAM_B_1           2
37      FIRST_GOAL_ODDS           2
38      LAST_GOALSCORER           2
39    FIRST_GOAL_SCORER           2
40           MATCH_ODDS          12
41          CORNER_ODDS           2
42          SENDING_OFF           2
43 OVER_UNDER_105_CORNR           2
44          CLEAN_SHEET           4
45        PENALTY_TAKEN           2
46  OVER_UNDER_55_CORNR           2
47          EXACT_GOALS           2
48 TO_SCORE_BOTH_HALVES           4
49    BOOKING_MATCH_BET           2
50  MATCH_ODDS_AND_BTTS           2
51 OVER_UNDER_135_CORNR           2
52   FIRST_HALF_CORNERS           2
53  OVER_UNDER_25_CARDS           2
54         FIRST_CORNER           2
55          ODD_OR_EVEN           2
56          DAILY_GOALS           1
57  FIRST_HALF_GOALS_15           2
58     CORNER_MATCH_BET           2
59   HAT_TRICKED_SCORED           2
60     GOAL_BOTH_HALVES           2
61        DOUBLE_CHANCE           2
62             TEAM_A_2           2
63             TEAM_B_2           2
64             TEAM_B_3           2
65     TEAM_TOTAL_GOALS           4
66  OVER_UNDER_45_CARDS           2
67         SHOWN_A_CARD           2
68  OVER_UNDER_85_CORNR           2
69        OVER_UNDER_65          12
70  FIRST_HALF_GOALS_25           2
71 HALF_WITH_MOST_GOALS           2
72        OVER_UNDER_55          12
73        OVER_UNDER_75           2
74       CORRECT_SCORE2           4
75       WINNING_MARGIN           2
76        OVER_UNDER_05          12
77    TEAM_B_WIN_TO_NIL           2
78   TO_SCORE_2_OR_MORE           2
79       ASIAN_HANDICAP           2
80  FIRST_HALF_GOALS_05           2
81    TO_SCORE_HATTRICK           2
82    TEAM_A_WIN_TO_NIL           2
83        OVER_UNDER_85           2</code></pre>
</div>
<div id="r-script" class="section level2">
<h2>R script</h2>
<p>Our script will need to log in to betfair, filter markets, retrieve market data before saving it somewhere.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(betfaiR)
bf &lt;-<span class="st"> </span><span class="kw">betfair</span>(<span class="dt">usr =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_USR&quot;</span>),
              <span class="dt">pwd =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_PWD&quot;</span>),
              <span class="dt">key =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;BETFAIR_KEY&quot;</span>))

markets &lt;-<span class="st"> </span>bf$<span class="kw">marketCatalogue</span>(<span class="dt">filter =</span> <span class="kw">marketFilter</span>(<span class="dt">eventTypeIds =</span> <span class="dv">1</span>,
                                                    <span class="dt">marketCountries =</span> <span class="st">&quot;GB&quot;</span>))</code></pre>
<a href="https://github.com/durtal/betfaiR" class="github-corner"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#d9230f; color:#fcfcfc; position: absolute; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>
<style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>


</body>
</html>
